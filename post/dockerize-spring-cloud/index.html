<!doctype html><html><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://g.nereusyi.com/"},"articleSection":"post","name":"使用Docker部署Spring Cloud","headline":"使用Docker部署Spring Cloud","description":"Spring Cloud和Docker整合","inLanguage":"en","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2019","datePublished":"2019-04-20 12:41:46 &#43;0800 CST","dateModified":"2019-04-20 12:41:46 &#43;0800 CST","url":"https://g.nereusyi.com/post/dockerize-spring-cloud/","wordCount":"217","keywords":["spring cloud","docker","Blog"]}</script><meta charset=utf-8><title>使用Docker部署Spring Cloud - NereusYi</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.54.0"><meta name=description content="Spring Cloud和Docker整合"><meta name=twitter:card content=summary><meta name=twitter:title content="使用Docker部署Spring Cloud"><meta name=twitter:description content="Spring Cloud和Docker整合"><meta property=og:title content="使用Docker部署Spring Cloud"><meta property=og:description content="Spring Cloud和Docker整合"><meta property=og:type content=article><meta property=og:url content=https://g.nereusyi.com/post/dockerize-spring-cloud/><meta property=article:published_time content=2019-04-20T12:41:46&#43;08:00><meta property=article:modified_time content=2019-04-20T12:41:46&#43;08:00><meta property=og:image content=https://g.nereusyi.com//images/logo.png><meta property=og:image:type content=image/png><meta property=og:image:width content=512><meta property=og:image:height content=512><meta itemprop=name content="使用Docker部署Spring Cloud"><meta itemprop=description content="Spring Cloud和Docker整合"><meta itemprop=datePublished content=2019-04-20T12:41:46&#43;08:00><meta itemprop=dateModified content=2019-04-20T12:41:46&#43;08:00><meta itemprop=wordCount content=217><meta itemprop=keywords content="spring cloud,docker,"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css><link rel=stylesheet href=https://g.nereusyi.com/css/main.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css><link href=//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-140619403-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-140619403-1');</script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?cad0d60e6cbf96c36edba25513ef42db";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script></head><body><div id=wrapper><header id=header><h1><a href=https://g.nereusyi.com/>Nereus</a></h1><nav class=links><ul><li><a href=https://g.nereusyi.com/post/><i class="fa fa-home">&nbsp;</i>Home</a></li><li><a href=https://g.nereusyi.com/post/><i class="fa fa-newspaper-o">&nbsp;</i>Blog</a></li><li><a href=https://g.nereusyi.com/categories/><i class="fa fa-sitemap">&nbsp;</i>Categories</a></li><li><a href=https://g.nereusyi.com/about/><i class="fa fa-id-card-o">&nbsp;</i>About</a></li></ul></nav><nav class=main><ul><li id=share-nav class=share-menu style=display:none><a class=fa-share-alt href=#share-menu>Share</a></li><li class=search><a class=fa-search href=#search>Search</a><form id=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://g.nereusyi.com/></form></li><li class=menu><a class=fa-bars href=#menu>Menu</a></li></ul></nav></header><section id=menu><section><form class=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://g.nereusyi.com/></form></section><section><ul class=links><li><a href=https://g.nereusyi.com/post/><h3><i class="fa fa-home">&nbsp;</i>Home</h3></a></li><li><a href=https://g.nereusyi.com/post/><h3><i class="fa fa-newspaper-o">&nbsp;</i>Blog</h3></a></li><li><a href=https://g.nereusyi.com/categories/><h3><i class="fa fa-sitemap">&nbsp;</i>Categories</h3></a></li><li><a href=https://g.nereusyi.com/about/><h3><i class="fa fa-id-card-o">&nbsp;</i>About</h3></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2019/how-spring-boot-2-started-up/>Spring Boot 2 启动流程解析</a></h3><time class=published datetime=2019-05-19>May 19, 2019</time></header></article><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2019/docker-basic/>Docker基础总结</a></h3><time class=published datetime=2019-04-28>April 28, 2019</time></header></article><a href=/post/ class=button>View more posts</a></div></section></section><section id=share-menu><section id=social-share-nav><ul class=links><header><h3>Share this post <i class="fa fa-smile-o"></i></h3></header><li><a href="//twitter.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;text=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud&amp;via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;title=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;title=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;title=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;description=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section></section><div id=main><article class=post><header><div class=title><h1><a href=https://g.nereusyi.com/post/dockerize-spring-cloud/>使用Docker部署Spring Cloud</a></h1><p>Spring Cloud和Docker整合</p></div><div class=meta><time class=published datetime=2019-04-20>April 20, 2019</time>
<span class=author></span><p>2 minute read</p></div></header><section id=social-share><ul class=icons><li><a href="//twitter.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;text=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud&amp;via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;title=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;title=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;title=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f&amp;description=%e4%bd%bf%e7%94%a8Docker%e9%83%a8%e7%bd%b2Spring%20Cloud" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fg.nereusyi.com%2fpost%2fdockerize-spring-cloud%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section><div id=content><h1 id=内容简介>内容简介</h1><p>这篇文章主要介绍如何使用<code>Docker</code>来部署一套基本的<code>Spring Cloud</code>环境，包含服务发现和服务调用，主要是展示<code>Spring Cloud</code> 和<code>Docker</code>是如何配合使用的。<code>Docker</code>和<code>Spring Cloud</code>都是使用基础组件。</p><h2 id=环境>环境</h2><ul><li>Java 8</li><li>CentOS 7.2</li></ul><h1 id=spring-cloud-组件>Spring Cloud 组件</h1><p><code>Spring Cloud</code>分为3个工程：</p><ul><li>discovery</li><li>service1</li><li>service2</li></ul><h2 id=discovery>discovery</h2><p>这个工程主要用于服务注册，相关文件代码如下：</p><p>启动类<code>DiscoveryApplication</code></p><pre><code class=language-java>@EnableEurekaServer
@SpringBootApplication
public class DiscoveryApplication {

    public static void main(String[] args) {
        SpringApplication.run(DiscoveryApplication.class, args);
    }

}
</code></pre><p>配置文件<code>application.yml</code></p><pre><code class=language-properties>spring:
  application:
    name: discovery
eureka:
  client:
    service-url:
      defaultZone: http://discovery:8080/eureka/
    register-with-eureka: false
    fetch-registry: false
</code></pre><h2 id=service1>service1</h2><p>启动类<code>Service1Application</code></p><pre><code class=language-java>@SpringBootApplication
@EnableDiscoveryClient
@RestController
public class Service1Application {

    public static void main(String[] args) {
        SpringApplication.run(Service1Application.class, args);
    }

    @Autowired
    RestTemplate restTemplate;

    @Bean
    @LoadBalanced
    RestTemplate restTemplate(){
        return new RestTemplate();
    }

    @RequestMapping(&quot;/&quot;)
    public String hello(){
        return &quot;service1 call result: &quot; + restTemplate.getForObject(&quot;http://service2/&quot;, String.class);
    }
}
</code></pre><p>配置文件<code>application.yml</code></p><pre><code class=language-properties>server:
  port: 8081
spring:
  application:
    name: service1
eureka:
  client:
    service-url:
      defaultZone: http://discovery:8080/eureka/
</code></pre><h2 id=service2>service2</h2><p>启动类<code>Service2Application</code></p><pre><code class=language-java>@SpringBootApplication
@EnableDiscoveryClient
@EnableEurekaClient
@RestController
public class Service2Application {

    public static void main(String[] args) {
        SpringApplication.run(Service2Application.class, args);
    }


    @RequestMapping(&quot;/&quot;)
    public String service2(){
        return &quot;hello, world&quot;;
    }
}
</code></pre><p>配置文件<code>application.yml</code></p><pre><code class=language-properties>server:
  port: 8082
spring:
  application:
    name: service2
eureka:
  client:
    service-url:
      defaultZone: http://discovery:8080/eureka/
</code></pre><h1 id=docker-部署>Docker 部署</h1><p>3个文件打包好之后，在已安装好Docker的机子上编写<code>Dockerfile</code>，示例：</p><pre><code>FROM openjdk:8-jdk-alpine
COPY *.jar app.jar
ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
</code></pre><p>为3个打包的文件都执行<code>build</code>构建镜像，分别为discovery,service1,service2，以discovery为例：</p><pre><code>docker build -t discovery:1.0 .
</code></pre><p>3个镜像启动有些差别，主要在链接容器网络方面</p><p>启动discovery容器</p><pre><code>docker run -d -h discovery --name discovery -p 8080:8080  discovery:1.0
</code></pre><p>启动service2容器</p><pre><code>docker run -d -p 8082:8082 -h service2 --name service2 --link discovery service2:1.0
</code></pre><p>启动service1容器</p><pre><code>docker run -d -p 8081:8081 -h service1 --name service1 --link discovery --link service2 service1:1.0
</code></pre><p>到这里，一套环境就部署完成了。</p><h1 id=测试>测试</h1><p>此时可以访问目标机器的8082端口，可以看到以下输出</p><pre><code>hello, world
</code></pre><p>访问目标机器的8081端口，可以看到以下输出</p><pre><code>service1 call result: hello, world
</code></pre><p>测试成功，输出内容正常。</p></div><footer><ul class=stats><li class=categories><ul><i class="fa fa-folder"></i><li><a class=article-category-link href=https://g.nereusyi.com/categories/java>java</a></li></ul></li><li class=tags><ul><i class="fa fa-tags"></i><li><a class=article-category-link href=https://g.nereusyi.com/tags/spring-cloud>spring cloud</a></li><li><a class=article-category-link href=https://g.nereusyi.com/tags/docker>docker</a></li></ul></li></ul></footer></article><article class=post><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"shortname"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article><ul class="actions pagination"><li><a href=https://g.nereusyi.com/post/new-website/ class="button big previous">新站点</a></li><li><a href=https://g.nereusyi.com/post/2019/docker-basic/ class="button big next">Docker基础总结</a></li></ul></div><section id=sidebar><section id=intro><a href=https://g.nereusyi.com/ class=logo><img src=https://g.nereusyi.com/img/web/logo.jpg alt=Nereus></a><header><h2>Nereus</h2><p>一名Java开发</p></header><ul class=icons><li><a href=//github.com/ivyboy target=_blank title=GitHub class="fa fa-github"></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><div class=posts-container><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2019/how-spring-boot-2-started-up/>Spring Boot 2 启动流程解析</a></h3><time class=published datetime=2019-05-19>May 19, 2019</time></header></article><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2019/docker-basic/>Docker基础总结</a></h3><time class=published datetime=2019-04-28>April 28, 2019</time></header></article></div><a href=/post/ class=button>View more posts</a></div></section><section id=categories><header><h3><a href=https://g.nereusyi.com/categories/>Categories</a></h3></header><p><article><header><a href=https://g.nereusyi.com/categories/docker/>docker</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/java/>java</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/life/>life</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/spring-boot/>spring boot</a>
<span style=float:right>1</span></header></article></p></section><section id=footer><p class=copyright>&copy; 2019
NereusYi
.
Powered by <a href=//gohugo.io target=_blank>Hugo</a>
<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png></a><br>This site is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p></section></section></div><a id=back-to-top href=# class="fa fa-arrow-up fa-border fa-2x"></a><script src=//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.11.0/languages/java.min.js></script><script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script><script src=https://code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js></script><script src=https://g.nereusyi.com/js/util.js></script><script src=https://g.nereusyi.com/js/main.js></script><script src=https://g.nereusyi.com/js/backToTop.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>