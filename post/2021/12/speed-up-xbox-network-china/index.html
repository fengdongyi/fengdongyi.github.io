<!doctype html><html><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/g.nereusyi.com\/"},"articleSection":"post","name":"使用CoreDNS加快XBOX在中国大陆的下载速度","headline":"使用CoreDNS加快XBOX在中国大陆的下载速度","description":"简介 最近弄了个xbox series主机，在主机上下载游戏的时候，发现下载速度的随机性很大，有时候能有100Mbps左右，大部分时候在10-20Mbps之间。经过搜索，发现其实大陆是有xbox的服务器的，只是默认分配不到。也看了些方案，说是用nginx之类的web服务器拦截http请求，然后返回301或302状态，让xbox跳回带cn后缀的服务器。看了上述原理，我感觉在DNS上完成应该就行，于是在家里服务器上搭建了CoreDNS。选用CoreDNS是因为之前在k8s上用过CoreDNS，对相关配置比较熟悉，性能也不错。\n安装和配置CoreDNS CoreDNS的安装十分简单，直接下载对应平台[1]的二进制包就行，也可以用Docker安装，看个人喜好。\n配置只需要在安装包的当前目录下建立一个名字为Corefile的文件就行，最初我的配置如下：\n. { rewrite name substring xboxlive.com xboxlive.cn forward . \/etc\/resolv.conf log errors cache } 保存之后直接启动.\/coredns。\n启动之后可以使用dig命令查看是否生效(可以修改@后的地址为服务器地址)：\ndig @127.0.0.1 www.xboxlive.com 通过查看应答，发现跟之前的不一样，而跟xboxlive.cn的返回一样，表示已部署成功并生效。\n在xbox中设置dns 打开xbox的网络设置，然后在高级设置中配置对应地址就行。\n测试xbox下载速度 马上去试了下载游戏，发现在浏览游戏界面时的速度变快了，但是下载速度还是在10-20Mbps之间。觉得有点奇怪，再次搜索相关的文章，发现可能是下载的游戏不是国区游戏的关系，最好是找到亚洲其他国家cdn的ip地址替换[2]。\n经过测试几个cdn地址，最终的Corefile配置如下：\n. { hosts { 219.76.10.33 assets1.xboxlive.com 219.76.10.184 assets1.xboxlive.com 219.76.10.33 assets2.xboxlive.com 219.76.10.184 assets2.xboxlive.com 219.76.10.33 dlassets.xboxlive.com 219.76.10.184 dlassets.xboxlive.com fallthrough } rewrite name substring xboxlive.com xboxlive.cn forward . \/etc\/resolv.conf log errors cache } 修改之后重启CoreDNS。\n配置文件中的log那一行，在测试稳定之后可以删掉，这样以后就不会每次xbox请求都会出现日志了。\n经过同一个游戏和其他游戏的下载验证，速度确实变快了很多，通常都在200Mbps左右，虽然还是没跑满带宽，但是比之前要好太多了。\n不过比起ps5什么都不配置就能达到300-400Mbps的下载速度来说，xbox的真是令人一言难尽。\n参考资料 [1] CoreDNS下载页面：https:\/\/github.com\/coredns\/coredns\/releases\n[2]xbox cdn相关：https:\/\/bbs.a9vg.com\/thread-5478226-1-1.html","inLanguage":"en","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2021","datePublished":"2021-12-04 17:25:11 \u002b0800 CST","dateModified":"2021-12-04 17:25:11 \u002b0800 CST","url":"https:\/\/g.nereusyi.com\/post\/2021\/12\/speed-up-xbox-network-china\/","wordCount":"70","keywords":["life","Blog"]}</script><meta charset=utf-8><title>使用CoreDNS加快XBOX在中国大陆的下载速度 - NereusYi</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.81.0"><meta name=description content="Nereus Yi 的博客,主要关注Java , Spring , Spring Boot , Spring Cloud , Design Pattern ,  Docker , Kubernetes , 微服务等主题"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用CoreDNS加快XBOX在中国大陆的下载速度"><meta name=twitter:description content="简介 最近弄了个xbox series主机，在主机上下载游戏的时候，发现下载速度的随机性很大，有时候能有100Mbps左右，大部分时候在10-20Mbps之间。经过搜索，发现其实大陆是有xbox的服务器的，只是默认分配不到。也看了些方案，说是用nginx之类的web服务器拦截http请求，然后返回301或302状态，让xbox跳回带cn后缀的服务器。看了上述原理，我感觉在DNS上完成应该就行，于是在家里服务器上搭建了CoreDNS。选用CoreDNS是因为之前在k8s上用过CoreDNS，对相关配置比较熟悉，性能也不错。
安装和配置CoreDNS CoreDNS的安装十分简单，直接下载对应平台[1]的二进制包就行，也可以用Docker安装，看个人喜好。
配置只需要在安装包的当前目录下建立一个名字为Corefile的文件就行，最初我的配置如下：
. { rewrite name substring xboxlive.com xboxlive.cn forward . /etc/resolv.conf log errors cache } 保存之后直接启动./coredns。
启动之后可以使用dig命令查看是否生效(可以修改@后的地址为服务器地址)：
dig @127.0.0.1 www.xboxlive.com 通过查看应答，发现跟之前的不一样，而跟xboxlive.cn的返回一样，表示已部署成功并生效。
在xbox中设置dns 打开xbox的网络设置，然后在高级设置中配置对应地址就行。
测试xbox下载速度 马上去试了下载游戏，发现在浏览游戏界面时的速度变快了，但是下载速度还是在10-20Mbps之间。觉得有点奇怪，再次搜索相关的文章，发现可能是下载的游戏不是国区游戏的关系，最好是找到亚洲其他国家cdn的ip地址替换[2]。
经过测试几个cdn地址，最终的Corefile配置如下：
. { hosts { 219.76.10.33 assets1.xboxlive.com 219.76.10.184 assets1.xboxlive.com 219.76.10.33 assets2.xboxlive.com 219.76.10.184 assets2.xboxlive.com 219.76.10.33 dlassets.xboxlive.com 219.76.10.184 dlassets.xboxlive.com fallthrough } rewrite name substring xboxlive.com xboxlive.cn forward . /etc/resolv.conf log errors cache } 修改之后重启CoreDNS。
配置文件中的log那一行，在测试稳定之后可以删掉，这样以后就不会每次xbox请求都会出现日志了。
经过同一个游戏和其他游戏的下载验证，速度确实变快了很多，通常都在200Mbps左右，虽然还是没跑满带宽，但是比之前要好太多了。
不过比起ps5什么都不配置就能达到300-400Mbps的下载速度来说，xbox的真是令人一言难尽。
参考资料 [1] CoreDNS下载页面：https://github.com/coredns/coredns/releases
[2]xbox cdn相关：https://bbs.a9vg.com/thread-5478226-1-1.html"><meta property="og:title" content="使用CoreDNS加快XBOX在中国大陆的下载速度"><meta property="og:description" content="简介 最近弄了个xbox series主机，在主机上下载游戏的时候，发现下载速度的随机性很大，有时候能有100Mbps左右，大部分时候在10-20Mbps之间。经过搜索，发现其实大陆是有xbox的服务器的，只是默认分配不到。也看了些方案，说是用nginx之类的web服务器拦截http请求，然后返回301或302状态，让xbox跳回带cn后缀的服务器。看了上述原理，我感觉在DNS上完成应该就行，于是在家里服务器上搭建了CoreDNS。选用CoreDNS是因为之前在k8s上用过CoreDNS，对相关配置比较熟悉，性能也不错。
安装和配置CoreDNS CoreDNS的安装十分简单，直接下载对应平台[1]的二进制包就行，也可以用Docker安装，看个人喜好。
配置只需要在安装包的当前目录下建立一个名字为Corefile的文件就行，最初我的配置如下：
. { rewrite name substring xboxlive.com xboxlive.cn forward . /etc/resolv.conf log errors cache } 保存之后直接启动./coredns。
启动之后可以使用dig命令查看是否生效(可以修改@后的地址为服务器地址)：
dig @127.0.0.1 www.xboxlive.com 通过查看应答，发现跟之前的不一样，而跟xboxlive.cn的返回一样，表示已部署成功并生效。
在xbox中设置dns 打开xbox的网络设置，然后在高级设置中配置对应地址就行。
测试xbox下载速度 马上去试了下载游戏，发现在浏览游戏界面时的速度变快了，但是下载速度还是在10-20Mbps之间。觉得有点奇怪，再次搜索相关的文章，发现可能是下载的游戏不是国区游戏的关系，最好是找到亚洲其他国家cdn的ip地址替换[2]。
经过测试几个cdn地址，最终的Corefile配置如下：
. { hosts { 219.76.10.33 assets1.xboxlive.com 219.76.10.184 assets1.xboxlive.com 219.76.10.33 assets2.xboxlive.com 219.76.10.184 assets2.xboxlive.com 219.76.10.33 dlassets.xboxlive.com 219.76.10.184 dlassets.xboxlive.com fallthrough } rewrite name substring xboxlive.com xboxlive.cn forward . /etc/resolv.conf log errors cache } 修改之后重启CoreDNS。
配置文件中的log那一行，在测试稳定之后可以删掉，这样以后就不会每次xbox请求都会出现日志了。
经过同一个游戏和其他游戏的下载验证，速度确实变快了很多，通常都在200Mbps左右，虽然还是没跑满带宽，但是比之前要好太多了。
不过比起ps5什么都不配置就能达到300-400Mbps的下载速度来说，xbox的真是令人一言难尽。
参考资料 [1] CoreDNS下载页面：https://github.com/coredns/coredns/releases
[2]xbox cdn相关：https://bbs.a9vg.com/thread-5478226-1-1.html"><meta property="og:type" content="article"><meta property="og:url" content="https://g.nereusyi.com/post/2021/12/speed-up-xbox-network-china/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-12-04T17:25:11+08:00"><meta property="article:modified_time" content="2021-12-04T17:25:11+08:00"><meta property="og:image" content="https://g.nereusyi.com//images/logo.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta content="xbox" name=keywords><meta itemprop=name content="使用CoreDNS加快XBOX在中国大陆的下载速度"><meta itemprop=description content="简介 最近弄了个xbox series主机，在主机上下载游戏的时候，发现下载速度的随机性很大，有时候能有100Mbps左右，大部分时候在10-20Mbps之间。经过搜索，发现其实大陆是有xbox的服务器的，只是默认分配不到。也看了些方案，说是用nginx之类的web服务器拦截http请求，然后返回301或302状态，让xbox跳回带cn后缀的服务器。看了上述原理，我感觉在DNS上完成应该就行，于是在家里服务器上搭建了CoreDNS。选用CoreDNS是因为之前在k8s上用过CoreDNS，对相关配置比较熟悉，性能也不错。
安装和配置CoreDNS CoreDNS的安装十分简单，直接下载对应平台[1]的二进制包就行，也可以用Docker安装，看个人喜好。
配置只需要在安装包的当前目录下建立一个名字为Corefile的文件就行，最初我的配置如下：
. { rewrite name substring xboxlive.com xboxlive.cn forward . /etc/resolv.conf log errors cache } 保存之后直接启动./coredns。
启动之后可以使用dig命令查看是否生效(可以修改@后的地址为服务器地址)：
dig @127.0.0.1 www.xboxlive.com 通过查看应答，发现跟之前的不一样，而跟xboxlive.cn的返回一样，表示已部署成功并生效。
在xbox中设置dns 打开xbox的网络设置，然后在高级设置中配置对应地址就行。
测试xbox下载速度 马上去试了下载游戏，发现在浏览游戏界面时的速度变快了，但是下载速度还是在10-20Mbps之间。觉得有点奇怪，再次搜索相关的文章，发现可能是下载的游戏不是国区游戏的关系，最好是找到亚洲其他国家cdn的ip地址替换[2]。
经过测试几个cdn地址，最终的Corefile配置如下：
. { hosts { 219.76.10.33 assets1.xboxlive.com 219.76.10.184 assets1.xboxlive.com 219.76.10.33 assets2.xboxlive.com 219.76.10.184 assets2.xboxlive.com 219.76.10.33 dlassets.xboxlive.com 219.76.10.184 dlassets.xboxlive.com fallthrough } rewrite name substring xboxlive.com xboxlive.cn forward . /etc/resolv.conf log errors cache } 修改之后重启CoreDNS。
配置文件中的log那一行，在测试稳定之后可以删掉，这样以后就不会每次xbox请求都会出现日志了。
经过同一个游戏和其他游戏的下载验证，速度确实变快了很多，通常都在200Mbps左右，虽然还是没跑满带宽，但是比之前要好太多了。
不过比起ps5什么都不配置就能达到300-400Mbps的下载速度来说，xbox的真是令人一言难尽。
参考资料 [1] CoreDNS下载页面：https://github.com/coredns/coredns/releases
[2]xbox cdn相关：https://bbs.a9vg.com/thread-5478226-1-1.html"><meta itemprop=datePublished content="2021-12-04T17:25:11+08:00"><meta itemprop=dateModified content="2021-12-04T17:25:11+08:00"><meta itemprop=wordCount content="70"><meta itemprop=keywords content="life,"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css><link rel=stylesheet href=https://g.nereusyi.com/css/main.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css><link href=//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-140619403-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-140619403-1')</script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?cad0d60e6cbf96c36edba25513ef42db",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script></head><body><div id=wrapper><header id=header><h1><a href=https://g.nereusyi.com/>Nereus</a></h1><nav class=links><ul><li><a href=https://g.nereusyi.com/post/><i class="fa fa-home">&nbsp;</i>Home</a></li><li><a href=https://g.nereusyi.com/post/><i class="fa fa-newspaper-o">&nbsp;</i>Blog</a></li><li><a href=https://g.nereusyi.com/categories/><i class="fa fa-sitemap">&nbsp;</i>Categories</a></li><li><a href=https://g.nereusyi.com/about/><i class="fa fa-id-card-o">&nbsp;</i>About</a></li></ul></nav><nav class=main><ul><li id=share-nav class=share-menu style=display:none><a class=fa-share-alt href=#share-menu>Share</a></li><li class=search><a class=fa-search href=#search>Search</a><form id=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://g.nereusyi.com/></form></li><li class=menu><a class=fa-bars href=#menu>Menu</a></li></ul></nav></header><section id=menu><section><form class=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://g.nereusyi.com/></form></section><section><ul class=links><li><a href=https://g.nereusyi.com/post/><h3><i class="fa fa-home">&nbsp;</i>Home</h3></a></li><li><a href=https://g.nereusyi.com/post/><h3><i class="fa fa-newspaper-o">&nbsp;</i>Blog</h3></a></li><li><a href=https://g.nereusyi.com/categories/><h3><i class="fa fa-sitemap">&nbsp;</i>Categories</h3></a></li><li><a href=https://g.nereusyi.com/about/><h3><i class="fa fa-id-card-o">&nbsp;</i>About</h3></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/>Post</a></h3><time class=published datetime=2021-12-04>December 4, 2021</time></header></article><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2021/12/speed-up-xbox-network-china/>使用CoreDNS加快XBOX在中国大陆的下载速度</a></h3><time class=published datetime=2021-12-04>December 4, 2021</time></header></article><a href=/post/ class=button>View more posts</a></div></section></section><section id=share-menu><section id=social-share-nav><ul class=links><header><h3>Share this post <i class="fa fa-smile-o"></i></h3></header><li><a href="//twitter.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&text=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6&via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&title=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&title=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&title=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&description=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section></section><div id=main><article class=post><header><div class=title><h1><a href=https://g.nereusyi.com/post/2021/12/speed-up-xbox-network-china/>使用CoreDNS加快XBOX在中国大陆的下载速度</a></h1></div><div class=meta><time class=published datetime=2021-12-04>December 4, 2021</time>
<span class=author></span><p>1 minute read</p></div></header><section id=social-share><ul class=icons><li><a href="//twitter.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&text=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6&via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&title=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&title=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&title=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f&description=%e4%bd%bf%e7%94%a8CoreDNS%e5%8a%a0%e5%bf%abXBOX%e5%9c%a8%e4%b8%ad%e5%9b%bd%e5%a4%a7%e9%99%86%e7%9a%84%e4%b8%8b%e8%bd%bd%e9%80%9f%e5%ba%a6" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f12%2fspeed-up-xbox-network-china%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section><div id=content><h1 id=简介>简介</h1><p>最近弄了个xbox series主机，在主机上下载游戏的时候，发现下载速度的随机性很大，有时候能有100Mbps左右，大部分时候在10-20Mbps之间。经过搜索，发现其实大陆是有xbox的服务器的，只是默认分配不到。也看了些方案，说是用nginx之类的web服务器拦截http请求，然后返回301或302状态，让xbox跳回带cn后缀的服务器。看了上述原理，我感觉在DNS上完成应该就行，于是在家里服务器上搭建了CoreDNS。选用CoreDNS是因为之前在k8s上用过CoreDNS，对相关配置比较熟悉，性能也不错。</p><h1 id=安装和配置coredns>安装和配置CoreDNS</h1><p>CoreDNS的安装十分简单，直接下载对应平台[1]的二进制包就行，也可以用Docker安装，看个人喜好。</p><p>配置只需要在安装包的当前目录下建立一个名字为<code>Corefile</code>的文件就行，最初我的配置如下：</p><pre><code>. {
    rewrite name substring xboxlive.com xboxlive.cn
    forward . /etc/resolv.conf
    log
    errors
    cache
}
</code></pre><p>保存之后直接启动<code>./coredns</code>。</p><p>启动之后可以使用dig命令查看是否生效(可以修改@后的地址为服务器地址)：</p><pre><code>dig @127.0.0.1 www.xboxlive.com
</code></pre><p>通过查看应答，发现跟之前的不一样，而跟xboxlive.cn的返回一样，表示已部署成功并生效。</p><h1 id=在xbox中设置dns>在xbox中设置dns</h1><p>打开xbox的网络设置，然后在高级设置中配置对应地址就行。</p><h1 id=测试xbox下载速度>测试xbox下载速度</h1><p>马上去试了下载游戏，发现在浏览游戏界面时的速度变快了，但是下载速度还是在10-20Mbps之间。觉得有点奇怪，再次搜索相关的文章，发现可能是下载的游戏不是国区游戏的关系，最好是找到亚洲其他国家cdn的ip地址替换[2]。</p><p>经过测试几个cdn地址，最终的<code>Corefile</code>配置如下：</p><pre><code>. {
    hosts {
        219.76.10.33 assets1.xboxlive.com
        219.76.10.184 assets1.xboxlive.com
        219.76.10.33 assets2.xboxlive.com
        219.76.10.184 assets2.xboxlive.com
        219.76.10.33 dlassets.xboxlive.com
        219.76.10.184 dlassets.xboxlive.com
        fallthrough
    }
    rewrite name substring xboxlive.com xboxlive.cn
    forward . /etc/resolv.conf
    log
    errors
    cache
}
</code></pre><p>修改之后重启CoreDNS。</p><p>配置文件中的log那一行，在测试稳定之后可以删掉，这样以后就不会每次xbox请求都会出现日志了。</p><p>经过同一个游戏和其他游戏的下载验证，速度确实变快了很多，通常都在200Mbps左右，虽然还是没跑满带宽，但是比之前要好太多了。</p><p>不过比起ps5什么都不配置就能达到300-400Mbps的下载速度来说，xbox的真是令人一言难尽。</p><h1 id=参考资料>参考资料</h1><p>[1] CoreDNS下载页面：https://github.com/coredns/coredns/releases</p><p>[2]xbox cdn相关：https://bbs.a9vg.com/thread-5478226-1-1.html</p></div><footer><ul class=stats><li class=categories><ul><i class="fa fa-folder"></i><li><a class=article-category-link href=https://g.nereusyi.com/categories/life>life</a></li></ul></li><li class=tags><ul><i class="fa fa-tags"></i><li><a class=article-category-link href=https://g.nereusyi.com/tags/life>life</a></li></ul></li></ul></footer></article><article class=post><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//nereusyi.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article><ul class="actions pagination"><li><a href=https://g.nereusyi.com/post/2021/12/quartz-scheduler-lower-table-name/ class="button big previous">让Quartz Scheduler在小写表名下运行</a></li></ul></div><section id=sidebar><section id=intro><a href=https://g.nereusyi.com/ class=logo><img src=https://g.nereusyi.com/img/web/logo.jpg alt=Nereus></a><header><h2>Nereus</h2><p>一名Java开发</p></header><ul class=icons><li><a href=//github.com/ivyboy target=_blank title=GitHub class="fa fa-github"></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><div class=posts-container><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/>Post</a></h3><time class=published datetime=2021-12-04>December 4, 2021</time></header></article><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2021/12/speed-up-xbox-network-china/>使用CoreDNS加快XBOX在中国大陆的下载速度</a></h3><time class=published datetime=2021-12-04>December 4, 2021</time></header></article></div><a href=/post/ class=button>View more posts</a></div></section><section id=categories><header><h3><a href=https://g.nereusyi.com/categories/>Categories</a></h3></header><p><article><header><a href=https://g.nereusyi.com/categories/java/>java</a>
<span style=float:right>10</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/spring-boot/>spring-boot</a>
<span style=float:right>4</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/jvm/>jvm</a>
<span style=float:right>3</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/docker/>docker</a>
<span style=float:right>2</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/life/>life</a>
<span style=float:right>2</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/devops/>devops</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/example/>example</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/performance/>performance</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/spring-security/>spring-security</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/springboot/>springboot</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/tool/>tool</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/>小技巧</a>
<span style=float:right>1</span></header></article></p></section><section id=footer><p class=copyright>&copy; 2021
NereusYi
.
Powered by <a href=//gohugo.io target=_blank>Hugo</a>
<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png></a><br>This site is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p></section></section></div><a id=back-to-top href=# class="fa fa-arrow-up fa-border fa-2x"></a><script src=//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.11.0/languages/java.min.js></script><script>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><script src=https://code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js></script><script src=https://g.nereusyi.com/js/util.js></script><script src=https://g.nereusyi.com/js/main.js></script><script src=https://g.nereusyi.com/js/backToTop.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>