<!doctype html><html><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/g.nereusyi.com\/"},"articleSection":"post","name":"Spring Boot Actuator 2 示例","headline":"Spring Boot Actuator 2 示例","description":"Spring Boot Actuator示例","inLanguage":"en","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2021","datePublished":"2021-03-20 13:51:35 \u002b0800 CST","dateModified":"2021-03-20 13:51:35 \u002b0800 CST","url":"https:\/\/g.nereusyi.com\/post\/2021\/03\/spring-boot-actuator-demo\/","wordCount":"223","keywords":["spring boot","Blog"]}</script><meta charset=utf-8><title>Spring Boot Actuator 2 示例 - NereusYi</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.81.0"><meta name=description content="Spring Boot Actuator示例"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spring Boot Actuator 2 示例"><meta name=twitter:description content="Spring Boot Actuator示例"><meta property="og:title" content="Spring Boot Actuator 2 示例"><meta property="og:description" content="Spring Boot Actuator示例"><meta property="og:type" content="article"><meta property="og:url" content="https://g.nereusyi.com/post/2021/03/spring-boot-actuator-demo/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-03-20T13:51:35+08:00"><meta property="article:modified_time" content="2021-03-20T13:51:35+08:00"><meta property="og:image" content="https://g.nereusyi.com//images/logo.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta content="spring boot,spring actuator" name=keywords><meta itemprop=name content="Spring Boot Actuator 2 示例"><meta itemprop=description content="Spring Boot Actuator示例"><meta itemprop=datePublished content="2021-03-20T13:51:35+08:00"><meta itemprop=dateModified content="2021-03-20T13:51:35+08:00"><meta itemprop=wordCount content="223"><meta itemprop=keywords content="spring boot,"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css><link rel=stylesheet href=https://g.nereusyi.com/css/main.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css><link href=//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-140619403-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-140619403-1')</script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?cad0d60e6cbf96c36edba25513ef42db",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script></head><body><div id=wrapper><header id=header><h1><a href=https://g.nereusyi.com/>Nereus</a></h1><nav class=links><ul><li><a href=https://g.nereusyi.com/post/><i class="fa fa-home">&nbsp;</i>Home</a></li><li><a href=https://g.nereusyi.com/post/><i class="fa fa-newspaper-o">&nbsp;</i>Blog</a></li><li><a href=https://g.nereusyi.com/categories/><i class="fa fa-sitemap">&nbsp;</i>Categories</a></li><li><a href=https://g.nereusyi.com/about/><i class="fa fa-id-card-o">&nbsp;</i>About</a></li></ul></nav><nav class=main><ul><li id=share-nav class=share-menu style=display:none><a class=fa-share-alt href=#share-menu>Share</a></li><li class=search><a class=fa-search href=#search>Search</a><form id=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://g.nereusyi.com/></form></li><li class=menu><a class=fa-bars href=#menu>Menu</a></li></ul></nav></header><section id=menu><section><form class=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://g.nereusyi.com/></form></section><section><ul class=links><li><a href=https://g.nereusyi.com/post/><h3><i class="fa fa-home">&nbsp;</i>Home</h3></a></li><li><a href=https://g.nereusyi.com/post/><h3><i class="fa fa-newspaper-o">&nbsp;</i>Blog</h3></a></li><li><a href=https://g.nereusyi.com/categories/><h3><i class="fa fa-sitemap">&nbsp;</i>Categories</h3></a></li><li><a href=https://g.nereusyi.com/about/><h3><i class="fa fa-id-card-o">&nbsp;</i>About</h3></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2021/06/java-file-nio-demo-2/>Java NIO File API 使用总结 2</a></h3><time class=published datetime=2021-06-20>June 20, 2021</time></header></article><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/>Post</a></h3><time class=published datetime=2021-06-20>June 20, 2021</time></header></article><a href=/post/ class=button>View more posts</a></div></section></section><section id=share-menu><section id=social-share-nav><ul class=links><header><h3>Share this post <i class="fa fa-smile-o"></i></h3></header><li><a href="//twitter.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&text=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b&via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&title=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&title=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&title=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&description=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section></section><div id=main><article class=post><header><div class=title><h1><a href=https://g.nereusyi.com/post/2021/03/spring-boot-actuator-demo/>Spring Boot Actuator 2 示例</a></h1><p>Spring Boot Actuator示例</p></div><div class=meta><time class=published datetime=2021-03-20>March 20, 2021</time>
<span class=author></span><p>2 minute read</p></div></header><section id=social-share><ul class=icons><li><a href="//twitter.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&text=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b&via=" target=_blank class="share-btn twitter"><i class="fa fa-twitter"></i><p>Twitter</p></a></li><li><a href="//plus.google.com/share?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f" target=_blank class="share-btn google-plus"><i class="fa fa-google-plus"></i><p>Google+</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f" target=_blank class="share-btn facebook"><i class="fa fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&title=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn reddit"><i class="fa fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&title=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn linkedin"><i class="fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&title=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn stumbleupon"><i class="fa fa-stumbleupon"></i><p>StumbleUpon</p></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f&description=Spring%20Boot%20Actuator%202%20%e7%a4%ba%e4%be%8b" target=_blank class="share-btn pinterest"><i class="fa fa-pinterest-p"></i><p>Pinterest</p></a></li><li><a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fg.nereusyi.com%2fpost%2f2021%2f03%2fspring-boot-actuator-demo%2f" target=_blank class="share-btn email"><i class="fa fa-envelope"></i><p>Email</p></a></li></ul></section><div id=content><h1 id=简介>简介</h1><p>Spring Boot Actuator为应用程序提供了各种开箱即用的运维特性，可以与应用方便的交互和监控。</p><p>使用环境：Java 11 和 <code>Spring Boot 2.4.3.RELEASE</code></p><h1 id=集成spring-boot-actuator>集成Spring Boot Actuator</h1><p>在Spring Boot中集成Spring Boot Actuator与集成其他的框架类似，在<code>pom.xml</code>里引入相关的starter就可以：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependency&gt;</span>
     <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
     <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-actuator<span style=color:#f92672>&lt;/artifactId&gt;</span>
 <span style=color:#f92672>&lt;/dependency&gt;</span>
<span style=color:#f92672>&lt;dependency&gt;</span>
     <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
     <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
</code></pre></div><p>由于大部分的使用场景还是web，所以这里也用Spring MVC做示例。</p><p>配置好<code>pom.xml</code>后，默认actuator仅暴露一些基本功能，实际使用中，根据需求暴露对应功能。为了简便测试，这里在<code>application.yml</code>中配置暴露全部功能：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>management</span>:
  <span style=color:#f92672>endpoints</span>:
    <span style=color:#f92672>web</span>:
      <span style=color:#f92672>exposure</span>:
        <span style=color:#f92672>include</span>: <span style=color:#e6db74>&#34;*&#34;</span>
  <span style=color:#f92672>endpoint</span>:
    <span style=color:#f92672>health</span>:
      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
      <span style=color:#f92672>show-details</span>: <span style=color:#ae81ff>always</span>
      <span style=color:#f92672>probes</span>:
        <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>shutdown</span>:
      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>metrics</span>:
    <span style=color:#f92672>export</span>:
      <span style=color:#f92672>jmx</span>:
        <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
<span style=color:#f92672>server</span>:
  <span style=color:#f92672>shutdown</span>: <span style=color:#ae81ff>graceful</span>
</code></pre></div><p>之后启动程序，在控制台应该能看到以下输出：</p><pre><code>2021-03-08 23:05:08.555  INFO 32637 --- [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 16 endpoint(s) beneath base path '/actuator'
</code></pre><h1 id=常用内置功能>常用内置功能</h1><p>Actuator内置了许多功能接口，下面介绍一些个人常用的。</p><h2 id=查看缓存>查看缓存</h2><pre><code>/actuator/caches
</code></pre><p>这个接口能查看被Spring管理的缓存，依赖具体实现</p><h2 id=查看环境>查看环境</h2><pre><code>/actuator/env
</code></pre><p>这个接口能看到目前生效的环境参数</p><h2 id=查看程序运行指标>查看程序运行指标</h2><pre><code>/actuator/metrics
</code></pre><p>访问之后能得到目前可以查询的指标：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;names&#34;</span>:[<span style=color:#e6db74>&#34;http.server.requests&#34;</span>,<span style=color:#e6db74>&#34;jvm.buffer.count&#34;</span>,<span style=color:#e6db74>&#34;jvm.buffer.memory.used&#34;</span>,<span style=color:#e6db74>&#34;jvm.buffer.total.capacity&#34;</span>,<span style=color:#e6db74>&#34;jvm.classes.loaded&#34;</span>,<span style=color:#e6db74>&#34;jvm.classes.unloaded&#34;</span>,<span style=color:#e6db74>&#34;jvm.gc.live.data.size&#34;</span>,<span style=color:#e6db74>&#34;jvm.gc.max.data.size&#34;</span>,<span style=color:#e6db74>&#34;jvm.gc.memory.allocated&#34;</span>,<span style=color:#e6db74>&#34;jvm.gc.memory.promoted&#34;</span>,<span style=color:#e6db74>&#34;jvm.gc.pause&#34;</span>,<span style=color:#e6db74>&#34;jvm.memory.committed&#34;</span>,<span style=color:#e6db74>&#34;jvm.memory.max&#34;</span>,<span style=color:#e6db74>&#34;jvm.memory.used&#34;</span>,<span style=color:#e6db74>&#34;jvm.threads.daemon&#34;</span>,<span style=color:#e6db74>&#34;jvm.threads.live&#34;</span>,<span style=color:#e6db74>&#34;jvm.threads.peak&#34;</span>,<span style=color:#e6db74>&#34;jvm.threads.states&#34;</span>,<span style=color:#e6db74>&#34;logback.events&#34;</span>,<span style=color:#e6db74>&#34;process.cpu.usage&#34;</span>,<span style=color:#e6db74>&#34;process.files.max&#34;</span>,<span style=color:#e6db74>&#34;process.files.open&#34;</span>,<span style=color:#e6db74>&#34;process.start.time&#34;</span>,<span style=color:#e6db74>&#34;process.uptime&#34;</span>,<span style=color:#e6db74>&#34;running.demo.timer&#34;</span>,<span style=color:#e6db74>&#34;system.cpu.count&#34;</span>,<span style=color:#e6db74>&#34;system.cpu.usage&#34;</span>,<span style=color:#e6db74>&#34;system.load.average.1m&#34;</span>,<span style=color:#e6db74>&#34;tomcat.sessions.active.current&#34;</span>,<span style=color:#e6db74>&#34;tomcat.sessions.active.max&#34;</span>,<span style=color:#e6db74>&#34;tomcat.sessions.alive.max&#34;</span>,<span style=color:#e6db74>&#34;tomcat.sessions.created&#34;</span>,<span style=color:#e6db74>&#34;tomcat.sessions.expired&#34;</span>,<span style=color:#e6db74>&#34;tomcat.sessions.rejected&#34;</span>]}
</code></pre></div><p>直接在url后加上对应的指标key能查询具体结果，比如：</p><pre><code>/actuator/metrics/system.cpu.count
</code></pre><p>可以查看到结果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;system.cpu.count&#34;</span>,<span style=color:#f92672>&#34;description&#34;</span>:<span style=color:#e6db74>&#34;The number of processors available to the Java virtual machine&#34;</span>,<span style=color:#f92672>&#34;baseUnit&#34;</span>:<span style=color:#66d9ef>null</span>,<span style=color:#f92672>&#34;measurements&#34;</span>:[{<span style=color:#f92672>&#34;statistic&#34;</span>:<span style=color:#e6db74>&#34;VALUE&#34;</span>,<span style=color:#f92672>&#34;value&#34;</span>:<span style=color:#ae81ff>12.0</span>}],<span style=color:#f92672>&#34;availableTags&#34;</span>:[]}
</code></pre></div><h2 id=查看request-mapping>查看Request Mapping</h2><pre><code>/actuator/mappings
</code></pre><h2 id=查看定时任务>查看定时任务</h2><pre><code>/actuator/scheduledtasks
</code></pre><h2 id=查看thread-dump>查看Thread dump</h2><pre><code>/actuator/threaddump
</code></pre><h1 id=扩展内置功能>扩展内置功能</h1><h2 id=扩展healthindicator>扩展HealthIndicator</h2><p>定时的健康检查能及时发现应用中的问题，actuator默认提供了一系列内置的应用健康指标：</p><pre><code>/actuator/health
</code></pre><p>访问之后可以看到结果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>,<span style=color:#f92672>&#34;components&#34;</span>:{<span style=color:#f92672>&#34;diskSpace&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>,<span style=color:#f92672>&#34;details&#34;</span>:{<span style=color:#f92672>&#34;total&#34;</span>:<span style=color:#ae81ff>999995129856</span>,<span style=color:#f92672>&#34;free&#34;</span>:<span style=color:#ae81ff>965321064448</span>,<span style=color:#f92672>&#34;threshold&#34;</span>:<span style=color:#ae81ff>10485760</span>,<span style=color:#f92672>&#34;exists&#34;</span>:<span style=color:#66d9ef>true</span>}},<span style=color:#f92672>&#34;livenessState&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>},<span style=color:#f92672>&#34;ping&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>},<span style=color:#f92672>&#34;readinessState&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>}},<span style=color:#f92672>&#34;groups&#34;</span>:[<span style=color:#e6db74>&#34;liveness&#34;</span>,<span style=color:#e6db74>&#34;readiness&#34;</span>]}
</code></pre></div><p>默认提供的是较为通用的健康指标，我们可以根据应用的特点，提供自定义的健康检查指标。比如对各种外部依赖的检查，应用内部状态的检查等。</p><p>假如应用对接了一个外部系统，我们可以扩展HealthIndicator来提供新的健康指标。扩展需要实现HealthIndicator接口，覆盖health()方法，并返回Health对象：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Component</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DemoHealthIndicator</span> <span style=color:#66d9ef>implements</span> HealthIndicator <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> HttpClient httpClient <span style=color:#f92672>=</span> HttpClient<span style=color:#f92672>.</span><span style=color:#a6e22e>newBuilder</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>version</span><span style=color:#f92672>(</span>HttpClient<span style=color:#f92672>.</span><span style=color:#a6e22e>Version</span><span style=color:#f92672>.</span><span style=color:#a6e22e>HTTP_1_1</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>connectTimeout</span><span style=color:#f92672>(</span>Duration<span style=color:#f92672>.</span><span style=color:#a6e22e>ofSeconds</span><span style=color:#f92672>(</span>10<span style=color:#f92672>))</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> Health <span style=color:#a6e22e>health</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> checkFooServiceHealth<span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> Health <span style=color:#a6e22e>checkFooServiceHealth</span><span style=color:#f92672>(){</span>
        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
            HttpRequest request <span style=color:#f92672>=</span> HttpRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>newBuilder</span><span style=color:#f92672>()</span>
                    <span style=color:#f92672>.</span><span style=color:#a6e22e>GET</span><span style=color:#f92672>()</span>
                    <span style=color:#f92672>.</span><span style=color:#a6e22e>uri</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://start.spring.io/&#34;</span><span style=color:#f92672>))</span>
                    <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>

            HttpResponse<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> httpClient<span style=color:#f92672>.</span><span style=color:#a6e22e>send</span><span style=color:#f92672>(</span>request<span style=color:#f92672>,</span> HttpResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>BodyHandlers</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ofString</span><span style=color:#f92672>());</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>response<span style=color:#f92672>.</span><span style=color:#a6e22e>statusCode</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> 200<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>return</span> Health<span style=color:#f92672>.</span><span style=color:#a6e22e>up</span><span style=color:#f92672>()</span>
                        <span style=color:#f92672>.</span><span style=color:#a6e22e>withDetail</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;statusCode&#34;</span><span style=color:#f92672>,</span> response<span style=color:#f92672>.</span><span style=color:#a6e22e>statusCode</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
            <span style=color:#f92672>}</span>
            <span style=color:#66d9ef>return</span> Health<span style=color:#f92672>.</span><span style=color:#a6e22e>down</span><span style=color:#f92672>()</span>
                    <span style=color:#f92672>.</span><span style=color:#a6e22e>withDetail</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;statusCode&#34;</span><span style=color:#f92672>,</span> response<span style=color:#f92672>.</span><span style=color:#a6e22e>statusCode</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>return</span> Health<span style=color:#f92672>.</span><span style=color:#a6e22e>unknown</span><span style=color:#f92672>()</span>
                    <span style=color:#f92672>.</span><span style=color:#a6e22e>withDetail</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;exception&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>这时再访问health接口，可以看到返回结果已经加上了自定义的健康指标：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>,<span style=color:#f92672>&#34;components&#34;</span>:{<span style=color:#f92672>&#34;demo&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>,<span style=color:#f92672>&#34;details&#34;</span>:{<span style=color:#f92672>&#34;statusCode&#34;</span>:<span style=color:#ae81ff>200</span>}},<span style=color:#f92672>&#34;diskSpace&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>,<span style=color:#f92672>&#34;details&#34;</span>:{<span style=color:#f92672>&#34;total&#34;</span>:<span style=color:#ae81ff>999995129856</span>,<span style=color:#f92672>&#34;free&#34;</span>:<span style=color:#ae81ff>965321064448</span>,<span style=color:#f92672>&#34;threshold&#34;</span>:<span style=color:#ae81ff>10485760</span>,<span style=color:#f92672>&#34;exists&#34;</span>:<span style=color:#66d9ef>true</span>}},<span style=color:#f92672>&#34;livenessState&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>},<span style=color:#f92672>&#34;ping&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>},<span style=color:#f92672>&#34;readinessState&#34;</span>:{<span style=color:#f92672>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;UP&#34;</span>}},<span style=color:#f92672>&#34;groups&#34;</span>:[<span style=color:#e6db74>&#34;liveness&#34;</span>,<span style=color:#e6db74>&#34;readiness&#34;</span>]}
</code></pre></div><h2 id=扩展infocontributor>扩展InfoContributor</h2><p>Info接口主要提供应用程序相关信息，一般会放在当前运行版本中不会改变的信息。比如访问Elasticsearch，就会展示一串json，表示当前Elasticsearch的版本，构建时间等信息。在实际应用中，我们可以使用该接口提供开发者信息，应用名称，版本，git版本等信息。</p><p>自定义Info信息与上面类似，实现InfoContributor接口，覆盖contribute方法：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Component</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DemoInfo</span> <span style=color:#66d9ef>implements</span> InfoContributor <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Value</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${spring.application.name}&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>private</span> String application<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>contribute</span><span style=color:#f92672>(</span>Info<span style=color:#f92672>.</span><span style=color:#a6e22e>Builder</span> builder<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        builder<span style=color:#f92672>.</span><span style=color:#a6e22e>withDetail</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;application&#34;</span><span style=color:#f92672>,</span> application<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>withDetail</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;git-version&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;2d5fg23&#34;</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>withDetail</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;version&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;1.0-SNAPSHOT&#34;</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>withDetail</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;dev&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Nereus Yi&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

<span style=color:#f92672>}</span>
</code></pre></div><p>为了演示简便，git-version、version信息直接写在代码里，实际应用中，可以通过读取根据maven构建信息来实现。</p><p>这时再访问info接口，</p><pre><code>/actuator/info
</code></pre><p>可以看到返回结果已经加上了自定义的信息：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;application&#34;</span>:<span style=color:#e6db74>&#34;actuator-demo&#34;</span>,<span style=color:#f92672>&#34;git-version&#34;</span>:<span style=color:#e6db74>&#34;2d5fg23&#34;</span>,<span style=color:#f92672>&#34;version&#34;</span>:<span style=color:#e6db74>&#34;1.0-SNAPSHOT&#34;</span>,<span style=color:#f92672>&#34;dev&#34;</span>:<span style=color:#e6db74>&#34;Nereus Yi&#34;</span>}
</code></pre></div><h1 id=总结>总结</h1><p>本文展示了actuator的常用功能示例和一些扩展，示例工程可以在<a href=https://github.com/nereusyi/spring-boot-demos/tree/main/actuator-demo>Github</a>上找到。</p><h1 id=参考资料>参考资料</h1><p>[1]https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html</p></div><footer><ul class=stats><li class=categories><ul><i class="fa fa-folder"></i><li><a class=article-category-link href=https://g.nereusyi.com/categories/spring-boot>spring boot</a></li></ul></li><li class=tags><ul><i class="fa fa-tags"></i><li><a class=article-category-link href=https://g.nereusyi.com/tags/spring-boot>spring boot</a></li></ul></li></ul></footer></article><article class=post><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//nereusyi.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article><ul class="actions pagination"><li><a href=https://g.nereusyi.com/post/2020/11/spring-security-basic-usage/ class="button big previous">Spring Security整合进Spring Boot中的基础用法</a></li><li><a href=https://g.nereusyi.com/post/2021/03/spring-boot-bean-validation/ class="button big next">Spring Boot Bean Validation 示例</a></li></ul></div><section id=sidebar><section id=intro><a href=https://g.nereusyi.com/ class=logo><img src=https://g.nereusyi.com/img/web/logo.jpg alt=Nereus></a><header><h2>Nereus</h2><p>一名Java开发</p></header><ul class=icons><li><a href=//github.com/ivyboy target=_blank title=GitHub class="fa fa-github"></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><div class=posts-container><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/2021/06/java-file-nio-demo-2/>Java NIO File API 使用总结 2</a></h3><time class=published datetime=2021-06-20>June 20, 2021</time></header></article><article class=mini-post><header><h3><a href=https://g.nereusyi.com/post/>Post</a></h3><time class=published datetime=2021-06-20>June 20, 2021</time></header></article></div><a href=/post/ class=button>View more posts</a></div></section><section id=categories><header><h3><a href=https://g.nereusyi.com/categories/>Categories</a></h3></header><p><article><header><a href=https://g.nereusyi.com/categories/java/>java</a>
<span style=float:right>7</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/spring-boot/>spring-boot</a>
<span style=float:right>4</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/jvm/>jvm</a>
<span style=float:right>3</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/docker/>docker</a>
<span style=float:right>2</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/devops/>devops</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/example/>example</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/life/>life</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/performance/>performance</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/spring-security/>spring-security</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/springboot/>springboot</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/tool/>tool</a>
<span style=float:right>1</span></header></article></p><p><article><header><a href=https://g.nereusyi.com/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/>小技巧</a>
<span style=float:right>1</span></header></article></p></section><section id=footer><p class=copyright>&copy; 2021
NereusYi
.
Powered by <a href=//gohugo.io target=_blank>Hugo</a>
<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png></a><br>This site is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p></section></section></div><a id=back-to-top href=# class="fa fa-arrow-up fa-border fa-2x"></a><script src=//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.11.0/languages/java.min.js></script><script>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><script src=https://code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js></script><script src=https://g.nereusyi.com/js/util.js></script><script src=https://g.nereusyi.com/js/main.js></script><script src=https://g.nereusyi.com/js/backToTop.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>